<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700%7CRoboto:400,700" rel="stylesheet">
    <link href='style.css' rel='stylesheet' type='text/css'>
    <title>LibertarianValues Results</title>
    <link rel="icon" type="image/svg" href="icon.svg">
    <link rel="shortcut icon" type="image/svg" href="icon.svg">
    <meta charset="utf-8">
    <script type="application/javascript" src="ideologies.js">
    </script>
</head>

<body>

    <h1>LibertarianValues 1.0<br>Results</h1>

    <h2><span class="weight-300" id="a-label"></span></h2>
    <div class="axis">
        <img id="img-authority" src="value_images/authority.svg" height="128pt" />
        <div class="bar authority" id="bar-authority">
            <div class="text-wrapper" id="authority"></div>
        </div>
        <div class="bar anarchy" id="bar-anarchy">
            <div class="text-wrapper" id="anarchy"></div>
        </div>
        <img id="img-anarchy" src="value_images/anarchy.svg" height="128pt" />
    </div>
    <h2><span class="weight-300" id="b-label"></span></h2>
    <div class="axis">
        <img id="img-hierarchy" src="value_images/hierarchy.svg" height="128pt" />
        <div class="bar hierarchy" id="bar-hierarchy">
            <div class="text-wrapper" id="hierarchy"></div>
        </div>
        <div class="bar heterarchy" id="bar-heterarchy">
            <div class="text-wrapper" id="heterarchy"></div>
        </div>
        <img id="img-heterarchy" src="value_images/heterarchy.svg" height="128pt" />
    </div>
    <h2><span class="weight-300" id="c-label"></span></h2>
    <div class="axis">
        <img id="img-planning" src="value_images/planning.svg" height="128pt" />
        <div class="bar planning" id="bar-planning">
            <div class="text-wrapper" id="planning"></div>
        </div>
        <div class="bar markets" id="bar-markets">
            <div class="text-wrapper" id="markets"></div>
        </div>
        <img id="img-markets" src="value_images/markets.svg" height="128pt" />
    </div>
    <h2><span class="weight-300" id="d-label"></span></h2>
    <div class="axis">
        <img id="img-collectivism" src="value_images/collectivism.svg" height="128pt" />
        <div class="bar collectivism" id="bar-collectivism">
            <div class="text-wrapper" id="collectivism"></div>
        </div>
        <div class="bar individualism" id="bar-individualism">
            <div class="text-wrapper" id="individualism"></div>
        </div>
        <img id="img-individualism" src="value_images/individualism.svg" height="128pt" />
    </div>
    <h2><span class="weight-300" id="e-label"></span></h2>
    <div class="axis">
        <img id="img-horun" src="value_images/horun.svg" height="128pt" />
        <div class="bar horun" id="bar-horun">
            <div class="text-wrapper" id="horun"></div>
        </div>
        <div class="bar verun" id="bar-verun">
            <div class="text-wrapper" id="verun"></div>
        </div>
        <img id="img-verun" src="value_images/verun.svg" height="128pt" />
    </div>
    <h2>Closest Match: <span class="weight-300" id="ideology-label"></span></h2>
    <h3><span class="weight-300" id="ideodesc-label"></span></h3>
    <p><br>You can download the image with the results below.</p>

    <h2>I don't like the results</h2>
    <p>Leave feedback by filling out this form:
        <a href="https://neomediavalist.limesurvey.net/345646?lang=en&newtest=Y">CLICK</a>
    </p>

    <h2>Next closest matches</h2>
    <p>With your closest match as 100% and farthest as 0%, here is how closely you
        matched the other ideologies.</p>

    <dl id="next-matches"></dl>

    <img id="banner-image" src="" alt="LibertarianValues Results" style="max-width: 100%; height: auto; display: block; margin: 0 auto; border: 3px solid #222; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
    <canvas id="banner" width=820 height=1360 style="font-family:Montserrat; display:none;"></canvas>
    <button class="button" onclick="location.href='index.html';"
        style="background-color: #2196f3; margin-top: 20px;">Back</button> <br>
    <!-- JavaScript for the test itself -->
    <script type="application/javascript"></script>
    <script>
        /* ideologies */
        function getQueryVariable (variable) {
        var query = window.location.search.substring(1)
        var vars = query.split('&')
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split('=')
            if (pair[0] === variable) {
            return pair[1]
            }
        }
        return (NaN)
        }

        function setBarValue (name, value) {
        const innerel = document.getElementById(name)
        const outerel = document.getElementById('bar-' + name)
        outerel.style.width = (value + '%')
        innerel.innerHTML = (value + '%')
        if (innerel.offsetWidth + 20 > outerel.offsetWidth) {
            innerel.style.visibility = 'hidden'
        }
        }

        function setLabel (val, ary) {
        ary = ary.split(',')
        if (val > 100) {
            return ''
        } else
        if (val > 90) {
            return ary[0]
        } else
        if (val > 75) {
            return ary[1]
        } else
        if (val > 60) {
            return ary[2]
        } else
        if (val >= 40) {
            return ary[3]
        } else
        if (val >= 25) {
            return ary[4]
        } else
        if (val >= 10) {
            return ary[5]
        } else
        if (val >= 0) {
            return ary[6]
        } else {
            return ''
        }
        }

        const authority = parseFloat(getQueryVariable('a')) || 0
        const hierarchy = parseFloat(getQueryVariable('b')) || 0
        const planning = parseFloat(getQueryVariable('c')) || 0
        const collectivism = parseFloat(getQueryVariable('d')) || 0
        const horun = parseFloat(getQueryVariable('e')) || 0

        const ideologyTexts = {
            'Hoppeanism': {
                name: 'Hoppeanism',
                desc: 'Hoppeanism is a libertarian philosophy based on the ideas of Hans-Hermann Hoppe. It emphasizes private property, voluntary exchange, and strict opposition to state authority. It advocates a society organized around free markets, contract-based communities, and radical decentralization.'
            },
            'Libertarian-Monarchism': {
                name: 'Libertarian Monarchism',
                desc: 'Libertarian Monarchism is a minarchist ideology advocating a constitutional monarchy to protect individual liberty and limit government power. Economically right and civically libertarian, it supports monarchs as neutral arbiters, combining free markets with constrained, decentralized governance.'
            },
            'Minarchism': {
                name: 'Minarchism',
                desc: 'Minarchism is a libertarian philosophy advocating a minimal state whose sole role is to protect individual rights, typically through police, courts, and military. It opposes extensive government intervention, emphasizing voluntary exchange, private property, and personal freedom as the foundation of society.'
            },
            'Paleolibertarianism': {
                name: 'Paleolibertarianism',
                desc: 'Paleolibertarianism is a right-libertarian ideology combining strict free-market principles with traditional conservative cultural values. It emphasizes limited government, property rights, and non-interventionism, while promoting social norms like family, religion, and community as foundations for a stable, voluntary society.'
            },
            'Anarcho-Capitalism': {
                name: 'Anarcho-Capitalism',
                desc: 'Anarcho-Capitalism advocates a stateless society based on voluntary exchange, private property, and free markets, but also supports direct democracy and opposes hierarchical structures. It seeks decentralized, horizontal decision-making while preserving individual economic freedom.'
            },
            'Avaritionism': {
                name: 'Avaritionism',
                desc: 'Avaritionism is an extreme right-libertarian ideology combining Anarcho-Egoism and Social Darwinism. It prioritizes individual desire above all, rejects altruism, and celebrates competition and self-interest, viewing the strong as justified in dominating or exploiting the weak to maximize personal gain.'
            },
            'Bleeding-Heart': {
                name: 'Bleeding Heart Libertarianism',
                desc: 'Bleeding Heart Libertarianism is a left-leaning libertarian ideology that combines strong support for individual liberty and free markets with concern for social justice and reducing poverty. It emphasizes voluntary cooperation, minimal state intervention, and policies that improve well-being for the disadvantaged.'
            },
            'NRx': {
                name: 'NRx',
                desc: 'Neoreaction emphasizes formal, corporate-style governance with strong executive authority. It advocates replacing democratic states with city-state-like sovereign entities (“patches”), run efficiently like businesses, prioritizing order, stability, and rule of law over egalitarianism.'
            },
            'Hayekism': {
                name: 'Hayekism',
                desc: 'Hayekism is an economic and political philosophy based on Friedrich Hayek’s ideas. It emphasizes free markets, limited government, spontaneous order, and the dangers of central planning, arguing that decentralized decision-making best preserves individual freedom and economic efficiency.'
            },
            'Anarcho-Communism': {
                name: 'Anarcho-Communism',
                desc: 'Anarcho-Communism is a stateless, classless ideology advocating the abolition of private property and hierarchies. It promotes common ownership of resources, voluntary cooperation, and direct democracy, aiming for a society where goods and services are freely distributed according to need.'
            },
            'Autonomism': {
                name: 'Autonomism',
                desc: 'Autonomism is an anti-authoritarian Marxist ideology emphasizing direct action by the working class. It rejects reliance on the state, trade unions, or political parties, advocating self-organized movements to achieve social and economic change from the ground up.'
            },
            'Democratic-Confederalism': {
                name: 'Democratic Confederalism',
                desc: 'Democratic Confederalism is a decentralized political system advocating local self-governance, direct democracy, and communal decision-making. It emphasizes gender equality, environmental sustainability, and ethnic pluralism, aiming to organize society through voluntary associations and networks rather than centralized state power.'
            },
            'Ego-Communism': {
                name: 'Ego-Communism',
                desc: 'Ego-Communism is a libertarian far-left ideology combining egoist philosophy with anarchist communism. It seeks personal fulfillment through abolishing capitalism and wage labor, emphasizing self-liberation over collective ideals while promoting progressive, anti-authoritarian social structures.'
            },
            'Anarcho-Mutualism': {
                name: 'Anarcho-Mutualism',
                desc: 'Anarcho-Mutualism is a libertarian socialist ideology advocating a stateless society based on voluntary exchange, mutual aid, and cooperative ownership. It supports markets without capitalism, labor-based property, and reciprocity, aiming to balance individual freedom with social equality.'
            },
            'Minarcho-Mutualism': {
                name: 'Minarcho-Mutualism',
                desc: 'Minarcho-Mutualism is a libertarian socialist ideology combining mutualist economics with a minimal state. It supports cooperative ownership, voluntary exchange, and labor-based property while retaining a small government limited to protecting individual rights and enforcing contracts.'
            },
            'Minarcho-Socialism': {
                name: 'Minarcho-Socialism',
                desc: 'Minarcho-Socialism is a libertarian left ideology combining worker-owned means of production with a minimal state. It seeks to protect workers’ rights and provide limited welfare while keeping industry independent of government, blending socialism with constrained, non-anarchist governance.'
            },
            'Platformism': {
                name: 'Platformism',
                desc: 'Platformism is an anarchist ideology advocating tightly organized groups united by shared principles. It emphasizes tactical and theoretical unity, collective responsibility, and federalism, aiming to influence working-class movements while rejecting internal disagreement and vanguard models.'
            }
        }

        document.getElementById('a-label').innerHTML = setLabel(authority, 
            "Extremely authorityary,Very authorityary,authorityary,Neutral,anarchyist,Very anarchyist,Extremely anarchyist")
        document.getElementById('b-label').innerHTML = setLabel(hierarchy, 
            "Extremely Voluntarist,Very Voluntarist,Voluntarist,Neutral,Economist,Very Economist,Extremely Economist")
        document.getElementById('c-label').innerHTML = setLabel(planning, 
            "Extremely planningist,Very planningist,planningist,Neutral,marketsist,Very marketsist,Extremely marketsist")
        document.getElementById('d-label').innerHTML = setLabel(collectivism, 
            "Extremely collectivismist,Very collectivismist,collectivismist,Neutral,individualism,Very individualism,Extremely individualism")
        document.getElementById('e-label').innerHTML = setLabel(horun, 
            "Extremely Partisan,Very Partisan,Partisan,Neutral,verunist,Very verunist,Extremely verunist")

        console.log('Values:', authority, hierarchy, planning, collectivism, horun)
        console.log('Ideologies object:', ideologies)
        console.log('Ideology texts:', ideologyTexts)
        const anarchy = (100 - authority).toFixed(1)
        const heterarchy = (100 - hierarchy).toFixed(1)
        const markets = (100 - planning).toFixed(1)
        const individualism = (100 - collectivism).toFixed(1)
        const verun = (100 - horun).toFixed(1)

        setBarValue('authority', authority)
        setBarValue('anarchy', anarchy)
        setBarValue('heterarchy', heterarchy)
        setBarValue('hierarchy', hierarchy)
        setBarValue('planning', planning)
        setBarValue('markets', markets)
        setBarValue('individualism', individualism)
        setBarValue('collectivism', collectivism)
        setBarValue('horun', horun)
        setBarValue('verun', verun)

        let ideology = ''
        let ideodesc = ''
        const ideologyIndexAndDistance = []
        var closestMatch = {}

        let index = 0
        for (const name of Object.keys(ideologies)) {
            let dist = 0
            dist += Math.pow(Math.abs(ideologies[name].a - authority), 2)
            dist += Math.pow(Math.abs(ideologies[name].c - planning), 2)
            dist += Math.pow(Math.abs(ideologies[name].b - hierarchy), 2)
            dist += Math.pow(Math.abs(ideologies[name].d - collectivism), 2)
            dist += Math.pow(Math.abs(ideologies[name].e - horun), 2)

            // ideologyToDistance[name] = dist
            ideologyIndexAndDistance.push({
            distance: dist,
            name,
            index
            })
            index++
        }

        ideologyIndexAndDistance.sort(function (a, b) {
            return a.distance - b.distance
        })

        const distances = ideologyIndexAndDistance.map(function (indexAndDistance) {
            return indexAndDistance.distance
        })

        const closestDistance = distances[0]
        const farthestDistance = distances[distances.length - 1]
        const distanceSpan = farthestDistance - closestDistance

        closestMatch = ideologyIndexAndDistance[0]
        document.getElementById('ideology-label').innerHTML = ideologyTexts[closestMatch.name].name
        document.getElementById('ideodesc-label').innerHTML = ideologyTexts[closestMatch.name].desc

        const nextMatches = document.getElementById('next-matches')
        let nextMatchesHTML = '';


        for (let i = 1; i < ideologyIndexAndDistance.length; i++) {
            const indexAndDistance = ideologyIndexAndDistance[i];
            const name = indexAndDistance.name;
            
            if (ideologyTexts[name]) {
                const ideology = ideologyTexts[name].name;
                const ideodesc = ideologyTexts[name].desc;
                const relativeDistance = 1 - (indexAndDistance.distance - closestDistance) / distanceSpan;
                const relativeDistancePercent = Math.round(relativeDistance * 1000) / 10;
                
                nextMatchesHTML += '<dt>' + ideology + ': ' + relativeDistancePercent + '%</dt>';

            } else {
                console.log('Missing ideology text for:', name);
            }
        }

        nextMatches.innerHTML = nextMatchesHTML;

        function createImage(src, x, y, w, h) {
            img = new Image ()
            img.src = src
            img.onLoad = function() {
                ctx.drawImage(img, x, y, w, h)
            }
        }

        function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            for (let n = 0; n < words.length; n++) {
                let testLine = line + words[n] + ' ';
                let metrics = ctx.measureText(testLine);
                let testWidth = metrics.width;
                if (testWidth > maxWidth && n > 0) {
                    ctx.fillText(line, x, y);
                    line = words[n] + ' ';
                    y += lineHeight;
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, x, y);
        }

        window.onload = function() {
            var c = document.createElement("canvas")
            var ctx = c.getContext("2d")
            c.width = 820;
            c.height = 1000;
            ctx.fillStyle = "#EEEEEE"
            ctx.fillRect(0,0,820,1000);

            function loadImage(src) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = src;
                });
            }

            Promise.all([
                loadImage('value_images/authority.svg'),
                loadImage('value_images/anarchy.svg'),
                loadImage('value_images/hierarchy.svg'),
                loadImage('value_images/heterarchy.svg'),
                loadImage('value_images/planning.svg'),
                loadImage('value_images/markets.svg'),
                loadImage('value_images/collectivism.svg'),
                loadImage('value_images/individualism.svg'),
                loadImage('value_images/horun.svg'),
                loadImage('value_images/verun.svg')
            ]).then(images => {
                ctx.drawImage(images[0], 20, 170, 100, 100);  // authority
                ctx.drawImage(images[1], 680, 170, 100, 100); // anarchy
                ctx.drawImage(images[2], 20, 290, 100, 100);  // hierarchy
                ctx.drawImage(images[3], 680, 290, 100, 100); // heterarchy
                ctx.drawImage(images[4], 20, 410, 100, 100);  // planning
                ctx.drawImage(images[5], 680, 410, 100, 100); // markets
                ctx.drawImage(images[6], 20, 530, 100, 100);  // collectivism
                ctx.drawImage(images[7], 680, 530, 100, 100); // individualism
                ctx.drawImage(images[8], 20, 650, 100, 100);  // horun
                ctx.drawImage(images[9], 680, 650, 100, 100); // verun

            ctx.fillStyle = '#222222'
            ctx.fillRect(120, 180, 560, 80)
            ctx.fillRect(120, 300, 560, 80)
            ctx.fillRect(120, 420, 560, 80)
            ctx.fillRect(120, 540, 560, 80)
            ctx.fillRect(120, 660, 560, 80)
            ctx.fillStyle = '#cecece'
            ctx.fillRect(120, 184, 5.6 * authority - 2, 72)
            ctx.fillStyle = '#111111'
            ctx.fillRect(682 - 5.6 * anarchy, 184, 5.6 * anarchy - 2, 72)
            ctx.fillStyle = 'rgb(146, 117, 0)'
            ctx.fillRect(120, 304, 5.6 * hierarchy - 2, 72)
            ctx.fillStyle = 'rgb(88, 116, 110)'
            ctx.fillRect(682 - 5.6 * heterarchy, 304, 5.6 * heterarchy - 2, 72)
            ctx.fillStyle = 'rgb(209, 0, 0)'
            ctx.fillRect(120, 424, 5.6 * planning - 2, 72)
            ctx.fillStyle = 'rgb(212, 177, 35)'
            ctx.fillRect(682 - 5.6 * markets, 424, 5.6 * markets - 2, 72)
            ctx.fillStyle = 'rgb(138, 0, 0)'
            ctx.fillRect(120, 544, 5.6 * collectivism - 2, 72)
            ctx.fillStyle = 'rgb(72, 142, 160)'
            ctx.fillRect(682 - 5.6 * individualism, 544, 5.6 * individualism - 2, 72)
            ctx.fillStyle = 'rgb(143, 172, 162)'
            ctx.fillRect(120, 664, 5.6 * horun - 2, 72)
            ctx.fillStyle = 'rgb(142, 102, 161)'
            ctx.fillRect(682 - 5.6 * verun, 664, 5.6 * verun - 2, 72)
            ctx.fillStyle = '#222222'
            ctx.font = '700 70px Montserrat'
            ctx.textAlign = 'left'
            ctx.fillText('LibertarianValues 1.0', 20, 90)
            ctx.font = '50px Montserrat'
            ctx.fillText(ideologyTexts[closestMatch.name].name, 20, 140)

            ctx.fillStyle = '#FFFFFF'
            ctx.textAlign = 'left'
            if (authority > 30) {ctx.fillText(authority + '%', 130, 237.5)}
            if (hierarchy > 30) {ctx.fillText(hierarchy + '%', 130, 357.5)}
            if (planning > 30) {ctx.fillText(planning + '%', 130, 477.5)}
            if (collectivism > 30) {ctx.fillText(collectivism + '%', 130, 597.5)}
            if (horun > 30) {ctx.fillText(horun + '%', 130, 717.5)}
            ctx.textAlign = 'right'
            if (anarchy > 30) {ctx.fillText(anarchy + '%', 670, 237.5)}
            if (heterarchy > 30) {ctx.fillText(heterarchy + '%', 670, 357.5)}
            if (markets > 30) {ctx.fillText(markets + '%', 670, 477.5)}
            if (individualism > 30) {ctx.fillText(individualism + '%', 670, 597.5)}
            if (verun > 30) {ctx.fillText(verun + '%', 670, 717.5)}

            ctx.fillStyle = '#222222'
            ctx.font = '700 20px Montserrat'
            ctx.textAlign = 'left';
            wrapText(ctx, ideologyTexts[closestMatch.name].desc, 20, 800, 790, 25);
            ctx.fillStyle = '#222222'
            ctx.font = '300 30px Montserrat'
            ctx.textAlign = 'right';
            ctx.fillText('neomediavalist.github.io/libvalues/', 780, 980)
            ctx.textAlign = 'center'
            ctx.fillText('' + document.getElementById('a-label').innerHTML, 400, 175)
            ctx.fillText('' + document.getElementById('b-label').innerHTML, 400, 295)
            ctx.fillText('' + document.getElementById('c-label').innerHTML, 400, 415)
            ctx.fillText('' + document.getElementById('d-label').innerHTML, 400, 535)
            ctx.fillText('' + document.getElementById('e-label').innerHTML, 400, 655)

            document.getElementById("banner-image").src = c.toDataURL();
            c.style.display = 'block';
            }).catch(error => {
                console.error('Error loading images:', error);
            });
        }
    </script>
</body>

</html>
